<!DOCTYPE html>
<html>
<head>
    <title>Mapbox Example</title>
    <link href="https://api.mapbox.com/mapbox-gl-js/v3.1.0/mapbox-gl.css" rel="stylesheet" />
    <style>
        body { margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
    </style>
</head>
<body>
    <div id="map"></div>
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.1.0/mapbox-gl.js"></script>
    <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoiYWFyb25pbmJyb29rbHluIiwiYSI6ImNtOGowMmZ0dzBjMDgycnB4eWdhZW9nZ2sifQ.Z70awiKsIraT8Mfh-T_iAg';

        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/aaroninbrooklyn/cm97wvhu900km01qu4y372sfy',
            center: [-73.95, 40.65],
            zoom: 11
        });

        const geocoder = new MapboxGeocoder({
            accessToken: mapboxgl.accessToken,
            mapboxgl: mapboxgl,
            marker: false,
            placeholder: 'Search for an address'
        });

        map.addControl(geocoder);
        map.addControl(new mapboxgl.NavigationControl());

        map.on('load', () => {
            // Click on BPL Council layer
            map.on('click', 'bplcouncilmap', (e) => {
                const props = e.features[0].properties;
                const lngLat = e.lngLat;

                const branchName = props["Branch Name"] || 'Branch name unavailable';
                const councilMember = props["Council Member Name"] || 'Unavailable';
                const officeAddress = props["District Office Address"] || 'Unavailable';
                const photoUrl = props["CM Photo"] || '';

                const popupHTML = `
                    <strong>${branchName}</strong><br/><br/>
                    <strong>Represented by:</strong><br/>
                    <strong>Council Member:</strong> ${councilMember}<br/>
                    <strong>District Office Address:</strong> ${officeAddress}<br/><br/>
                    <img src="${photoUrl}" alt="Council Member Photo" style="width:100%; max-width:240px; border-radius:4px;">
                `;

                new mapboxgl.Popup()
                    .setLngLat(lngLat)
                    .setHTML(popupHTML)
                    .addTo(map);
            });

            map.on('mouseenter', 'bplcouncilmap', () => {
                map.getCanvas().style.cursor = 'pointer';
            });
            map.on('mouseleave', 'bplcouncilmap', () => {
                map.getCanvas().style.cursor = '';
            });
        });

        // Optional: Keep geocoder logic as-is unless you want to show rep info there too
    </script>
</body>
</html>
